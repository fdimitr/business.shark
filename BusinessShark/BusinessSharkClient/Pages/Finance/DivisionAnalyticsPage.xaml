<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="BusinessSharkClient.Pages.Finance.DivisionAnalyticsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.Maui;assembly=LiveChartsCore.SkiaSharpView.Maui"
    xmlns:finance="clr-namespace:BusinessSharkClient.Pages.Finance"
    xmlns:viewModels="clr-namespace:BusinessSharkClient.Logic.ViewModels"
    ControlTemplate="{StaticResource PageWithStatusBar}"
    Shell.NavBarIsVisible="False"
    Title="Division Analytics">

    <ScrollView>
        <VerticalStackLayout>
            <VerticalStackLayout>
                <!-- ðŸ”¹ ÐšÐ¾Ð¼Ð°Ð½Ð´Ð½Ð°Ñ Ð¿Ð°Ð½ÐµÐ»ÑŒ -->
                <Grid ColumnDefinitions="50, Auto,*"
                      BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource Gray950}}">
                    <ImageButton x:Name="BackButton"
                         Grid.Column="0"
                         Source="arrow_dropleft_48_w.png" 
                         Clicked="OnBackButtonClicked"
                         HeightRequest="30"
                         WidthRequest="30"
                         VerticalOptions="Center"
                         HorizontalOptions="Start"
                         Aspect="AspectFit">
                        <!-- Use a standard back arrow icon (e.g., from FontAwesome or a .png) -->
                        <!-- As a fallback, we can use text -->
                        <ImageButton.Triggers>
                            <Trigger TargetType="ImageButton" Property="Source" Value="back_icon.png">
                                <Setter Property="BackgroundColor" Value="Transparent" />
                            </Trigger>
                        </ImageButton.Triggers>
                    </ImageButton>

                    <Label Grid.Column="1"
                   x:DataType="finance:DivisionAnalyticsPage"
                   Text="{Binding Title}"
                   TextColor="{StaticResource White}"
                   FontSize="20"
                   FontAttributes="Bold"
                   HorizontalOptions="Center"
                   VerticalOptions="Center" />
                </Grid>
            </VerticalStackLayout>
            <VerticalStackLayout x:Name="AnalyticLayout" Padding="10" Spacing="15" x:DataType="viewModels:DivisionAnalyticsViewModel">
                <!-- Chart card -->
                <Border Padding="5" Background="White" Stroke="#E0E0E0" StrokeThickness="1">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="5" />
                    </Border.StrokeShape>
                    <Border.Shadow>
                        <Shadow Opacity="0.25" Radius="10" />
                    </Border.Shadow>
                    <VerticalStackLayout>
                        <lvc:CartesianChart
                        x:Name="MainChart"
                        HeightRequest="320"
                        Series="{Binding Series}"
                        XAxes="{Binding XAxes}"
                        YAxes="{Binding YAxes}"
                        Margin="0" />
                    </VerticalStackLayout>
                </Border>

                <!-- Table card -->
                <Border Padding="0" Background="White" Stroke="#E0E0E0" StrokeThickness="1">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12" />
                    </Border.StrokeShape>
                    <Border.Shadow>
                        <Shadow Opacity="0.25" Radius="10" />
                    </Border.Shadow>
                    <VerticalStackLayout>
                        <Label Text="Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð°: Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÐµÐ»Ð¸ Ð¿Ð¾ Ð´Ð½ÑÐ¼" FontAttributes="Bold" Margin="12,12,12,6"/>
                            <ScrollView x:Name="DataScrollView"
                                        Orientation="Horizontal"
                                        HorizontalScrollBarVisibility="Always"
                                        Margin="0,0,0,20"
                                        Loaded="OnDataScrollViewLoaded">
                                <Grid x:Name="DataGrid"
                                      Padding="12"
                                      ColumnSpacing="0"
                                      RowSpacing="0" />
                            </ScrollView>
                    </VerticalStackLayout>
                </Border>

            </VerticalStackLayout>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
